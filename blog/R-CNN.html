<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="R-CNNR-CNN由UCB的视觉实验室提出，将传统的视觉方法selective search和CNN结合到一起。实际上我感觉应该是受到了当时Alexnet的启发，因为当时已经有使用selective search得到候选区域再进行分类的做法，只不过没有用到CNN而已。主要思路就是先在Input Image上做selective search得到2000个region proposal，再把每个p">
<meta name="keywords" content="Object Detection,Paper Reading">
<meta property="og:type" content="article">
<meta property="og:title" content="R-CNN">
<meta property="og:url" content="http://github.com/R-CNN.html">
<meta property="og:site_name" content="Kai Chen&#39;s Homepage">
<meta property="og:description" content="R-CNNR-CNN由UCB的视觉实验室提出，将传统的视觉方法selective search和CNN结合到一起。实际上我感觉应该是受到了当时Alexnet的启发，因为当时已经有使用selective search得到候选区域再进行分类的做法，只不过没有用到CNN而已。主要思路就是先在Input Image上做selective search得到2000个region proposal，再把每个p">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://github.com/images/R-CNN/1.png">
<meta property="og:image" content="http://github.com/images/R-CNN/2.png">
<meta property="og:image" content="http://github.com/images/R-CNN/3.png">
<meta property="og:updated_time" content="2019-01-01T11:25:02.277Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R-CNN">
<meta name="twitter:description" content="R-CNNR-CNN由UCB的视觉实验室提出，将传统的视觉方法selective search和CNN结合到一起。实际上我感觉应该是受到了当时Alexnet的启发，因为当时已经有使用selective search得到候选区域再进行分类的做法，只不过没有用到CNN而已。主要思路就是先在Input Image上做selective search得到2000个region proposal，再把每个p">
<meta name="twitter:image" content="http://github.com/images/R-CNN/1.png">



  <link rel="alternate" href="/atom.xml" title="Kai Chen's Homepage" type="application/atom+xml">




  <link rel="canonical" href="http://github.com/R-CNN.html">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>R-CNN | Kai Chen's Homepage</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

<a href="https://KaiChen1998.github.io" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kai Chen's Homepage</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about_me">

    
    
    
      
    

    

    <a href="/About_me/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About_me</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/R-CNN.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kai Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kai Chen's Homepage">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">R-CNN
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-20 10:33:00" itemprop="dateCreated datePublished" datetime="2018-12-20T10:33:00+08:00">2018-12-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-01 19:25:02" itemprop="dateModified" datetime="2019-01-01T19:25:02+08:00">2019-01-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Computer-Science/" itemprop="url" rel="index"><span itemprop="name">Computer Science</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Computer-Science/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h1><p>R-CNN由UCB的视觉实验室提出，将传统的视觉方法selective search和CNN结合到一起。实际上我感觉应该是受到了当时Alexnet的启发，因为当时已经有使用selective search得到候选区域再进行分类的做法，只不过没有用到CNN而已。主要思路就是先在Input Image上做selective search得到2000个region proposal，再<strong>把每个proposal wrap为227 <em> 227 </em> 3 的形式</strong>（需要resize）输入CNN，再输入到<strong>SVM分类器得</strong>到分类和一个<strong>Bounding Box regressor</strong>得到box的修正。</p>
<h2 id="Training-Process"><a href="#Training-Process" class="headerlink" title="Training Process"></a>Training Process</h2><ul>
<li>Region proposal：使用selective search生成2000个候选区域。</li>
<li>Fine Tuning：我认为Fine tuning本质上还是<strong>图像分类问题</strong>，将每一个region当作独立的Image，只是为了适应新的domain。首先使用Alexnet在image classification dataset上预训练之后，<strong>做fine tuning</strong>。为了适应新的数据集只有N = 20&lt;1000的情况，我们保持原有Alexnet的结构不变，只是重新初始化了分类器，使用一个<strong>(N + 1) classes</strong> 分类器。我们使用wrapped region peoposals，将与任意一个<strong>ground truth IOU&gt;0.5</strong>的region proposal作为正样本，剩余作为负样本。这里我认为正样本值得是有object的region，其中包括它的calss label，负样本为background样本。每一个batch包括32个正样本和96个负样本。</li>
<li>SVM detection Classifier：SVM用于detection。训练SVM的过程，我们只取ground truth作为正样本，取和ground truth的IOU小于0.3的为负样本。</li>
<li>训练过程中我们会碰到如何判断一个训练结果（即分类结果是对是错），如果一个region只是部分overlap ground truth，那么我们就计算这两个部分的IOU，如果&gt;阈值<strong>（这里为0.3，和上面的不同）</strong>就判断为正样本，否则为负样本，这也是一种hard negative mining的训练方式，可以帮助更快收敛，下面做详细介绍。</li>
<li>Bounding Box regression：我们也对bounding box做回归修正。我们直接对四个坐标做修正（回归器输出是修正值），但是不直接用四个坐标为输入，而是使用这个region proposal的<strong>pool5 feature vector</strong>作为函数的输入，对x，y做平移，对w，y做放缩。此外我们学习的函数都是线性函数，就只用一个权值矩阵就好了。具体公式请参考论文。注意这里的对应关系根据IOU&gt;0.6获得。这里P是selective search的结果，G~是修正结果。</li>
<li>R-CNN训练过程分为三个独立的步骤：fine tuning，SVM然后才是bounding box regressor。这样必须分开来训练导致了训练时间的浪费。</li>
</ul>
<p><img src="/images/R-CNN/1.png" alt="img"></p>
<h3 id="迁移学习"><a href="#迁移学习" class="headerlink" title="迁移学习"></a>迁移学习</h3><p>有监督预训练也称之为迁移学习，举例说明：若有大量标注信息的人脸年龄分类的正负样本图片，利用样本训练了CNN网络用于人脸年龄识别；现在要通过人脸进行性别识别，那么就可以去掉已经训练好的人脸年龄识别网络CNN的最后一层或几层，换成所需要的分类层，前面层的网络参数直接使用为初始化参数，修改层的网络参数随机初始化，再利用人脸性别分类的正负样本图片进行训练，得到人脸性别识别网络，这种方法就叫做有监督预训练。这种方式可以很好地解决小样本数据无法训练深层CNN网络的问题，我们都知道小样本数据训练很容易造成网络过拟合，但是在大样本训练后利用其参数初始化网络可以很好地训练小样本，这解决了小样本训练的难题。这篇文章最大的亮点就是采用了这种思想，ILSVRC样本集上用于图片分类的含标注类别的训练集有1millon之多，总共含有1000类；而PASCAL VOC 2007样本集上用于物体检测的含标注类别和位置信息的训练集只有10k，总共含有20类，直接用这部分数据训练容易造成过拟合，因此文中利用ILSVRC2012的训练集先进行有监督预训练。</p>
<h3 id="hard-negative-mining"><a href="#hard-negative-mining" class="headerlink" title="hard negative mining"></a>hard negative mining</h3><ol>
<li>hard-negative mining<br>negative相对于positive，是相对于正样本来说，不含有目标的负样本。但是，negative包括很多，有完全不包含目标的的，也有部分含有的，也就是容易/不容易被分为负样本的。其中比较容易被判定是负样本（比如全是背景）的对于训练并不能起到很好的监督作用。我们需要找一些难划分的负样本，也就是hard negative，来增强网络的判别性能。在训练好分类器之后进行分类，但是发现，分类器效果不是很好，经常会得到一些错误的正样本，这个时候这些判别错误的样本可以作为负样本继续训练网络。</li>
<li>具体的流程</li>
</ol>
<ul>
<li>在检测问题中，预定义的分类器得到的错误结果，也就是FP，记录其对应特征和分类器得到的概率。</li>
<li>重新训练，按概率值进行排序，再使用排序后的对应特征重新训练分类器</li>
<li>迭代以上过程</li>
</ul>
<h2 id="Testing-Process"><a href="#Testing-Process" class="headerlink" title="Testing Process"></a>Testing Process</h2><p>没有太多的变动，过程中由于没有ground truth不需要对2000个region proposal进行取舍（也因此成为了瓶颈）。测试的时候使用N=20个分类器，每个region proposal得到20个分类得分，然后在每一个class空间中做<strong>大于阈值</strong>检测和<strong>non-maximal suppression</strong>后输出结果。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://export.arxiv.org/pdf/1311.2524" target="_blank" rel="noopener">Original Paper</a></li>
<li><a href="https://www.cnblogs.com/zf-blog/p/6740736.html" target="_blank" rel="noopener">CSDN解析</a></li>
</ol>
<h1 id="Fast-CNN"><a href="#Fast-CNN" class="headerlink" title="Fast CNN"></a>Fast CNN</h1><p>R-CNN虽然显著的提高了mAP，但是算法耗时太长，每一个Region Proposal都要从零开始经过卷积运算。SSPNet发现了这个问题，开始使用共享卷积运算，即CNN直接输入Image获得Feature Map，在feature map的基础上进行判断，这样针对于同一张图片的ROI share了卷积运算，但是对于不同Image的ROI则不可以共享（因为back pro的时候使用的前向参数不同），另外SSPNet和R-CNN都存在不能end to end 的训练，即fine tuning、classifier和bounding box regressor必须分开来训练。Fast R-CNN针对以上问题提出改进，在稳定提高mAP的同时极大的改善了训练和测试时间。</p>
<h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>基于VGG16。训练过程没有太大的改动，现在Image上查找ROI，然后将Image输入到CNN当中获得feature map，通过与SSPNet相同的<strong>ROI projection</strong>找到feature map中与ROI对应的位置，然后通过ROI pooling得到fixed-sized输出，通过FC层得到ROI feature vector，通过分类器（K+1 classes）和bounding box regressor（每个class一个4元组）得到输出。注意，<strong>这里每个ROI有K个bounding box输出，对应K类</strong>。</p>
<h3 id="ROI-projection"><a href="#ROI-projection" class="headerlink" title="ROI projection"></a>ROI projection</h3><p>ROI projection——来自于SSPNet，其实就是找到feature map上面对应的ROI的feature。</p>
<h3 id="ROI-pooling-layer"><a href="#ROI-pooling-layer" class="headerlink" title="ROI pooling layer"></a>ROI pooling layer</h3><p>Spatial pyramid pooling network：SSP对于proposal的feature map使用了不同size的pooling，从而获得了不同size的fix-sized output之后连接起来一起作为输出。</p>
<p>ROI pooling与之相同的是，两者都是为了将no-fixed size的ROI<strong>（本文中讨论的所有ROI都基于feature map）</strong>转化为fix-sized输出。ROI pooling layer可以看作是只有一层的pyramid layer。（文中也证明了使用multi-scale并不会带来显著效果，但是会严重提升时间消耗）</p>
<h3 id="Process：end-to-end-training"><a href="#Process：end-to-end-training" class="headerlink" title="Process：end to end training"></a>Process：end to end training</h3><p>Fast R-CNN的一个重要特点就是可以end to end的使用back prop训练所有的参数。同样的，先去预训练好的VGG模型，去掉最后一个max pooling layer用ROI pooling层代替，1000-class sotfmax分类器用两个分支网络代替。SSP和R-CNN因为不是end-end的网络，所以不属于同一个image的ROI不能share之前的卷积运算，因此造成了训练瓶颈。</p>
<p>这里，我们使用<strong>Hierarchically sample</strong>的方法构造batch的方式：先sample N( = 2)张image，然后每张图片中sample R/N个ROI，较小的N保证了share。使用Multi-loss训练分类器和Regressor（预测值仍然是offset），只有正样本才有bounding box loss，其中regression loss使用smooth L1 loss。<strong>每一个class都有一个自己的regressor。</strong></p>
<p><img src="/images/R-CNN/2.png" alt="img"></p>
<h2 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h2><p>一次前馈即可，最后和R-CNN相同，在每个类别空间里做阈值检测和非极大值抑制之后输出结果。</p>
<h2 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://www.cv-foundation.org/openaccess/content_iccv_2015/papers/Girshick_Fast_R-CNN_ICCV_2015_paper.pdf" target="_blank" rel="noopener">paper</a></li>
<li><a href="https://blog.csdn.net/shenxiaolu1984/article/details/51036677" target="_blank" rel="noopener">CSDN</a></li>
</ol>
<h1 id="Faster-CNN"><a href="#Faster-CNN" class="headerlink" title="Faster CNN"></a>Faster CNN</h1><p>主要就是解决了selective search的时间瓶颈。不再使用固定的方式来生成ROI，而是使用RPN生成ROI后输入到Fast R-CNN中进行判断。注意本文与Fast R-CNN相同，所有的ROI均在feature map层面讨论，注意区分ROI，bounding box，archor这几个概念。</p>
<h2 id="Region-Proposal-Network-（RPN）"><a href="#Region-Proposal-Network-（RPN）" class="headerlink" title="Region Proposal Network （RPN）"></a>Region Proposal Network （RPN）</h2><p>sliding window network：取最后一个conv层（i.e.feature map），使用一个n <em> n (n=3 here)滑过feature map，生成更低纬度的feature vector，然后输出到一个二元分类器和一个regressor中<strong>（均为FC网络）</strong>。每一个sliding window会产生k个不同size and 分辨率的archor，一共会产生W </em> H <em> k个predicting（WH为feature map的维度）。一般来说是先输入到一个3 </em> 3的卷积层之后分别输入到两个1 * 1的卷积层中得到输出。  </p>
<h3 id="Archor"><a href="#Archor" class="headerlink" title="Archor"></a>Archor</h3><p>首先我们需要知道anchor的本质是什么，本质是SPP(spatial pyramid pooling)思想的逆向。而SPP本身是做什么的呢，就是将不同尺寸的输入resize成为相同尺寸的输出。所以SPP的逆向就是，将相同尺寸的输出，倒推得到不同尺寸的输入。<strong>也就是说通过我们当前的sliding window来推断出原始图像中对应的box，即archor是存在于原始图像的，从下文我们可以看出，由于我们逆向选择的是sliding window的中心点对应原图的感受野的中心点，所以我们可以根据不同的分辨率和size选择不同的archor。</strong></p>
<p>对于每个3x3的窗口，计算这个<strong>滑动窗口的中心点</strong>所对应的<strong>原始图片的中心点</strong>。然后作者假定，这个3x3窗口，是从原始图片上通过SPP池化得到的，而这个池化的区域的面积以及比例，就是一个个的anchor。换句话说，对于每个3x3窗口，作者假定它来自9种不同原始区域的池化，但是这些池化在原始图片中的中心点，都完全一样。这个中心点，就是刚才提到的，3x3窗口中心点所对应的原始图片中的中心点。如此一来，在每个窗口位置，我们都可以根据9个不同长宽比例、不同面积的anchor，逆向推导出它所对应的原始图片中的一个区域，这个区域的尺寸以及坐标，都是已知的。所以我们通过滑动窗口和anchor，成功得到了 51x39x9 个原始图片的proposal。</p>
<p>我觉得这是设置Archor，就像是YOLO中的grid，是为了给ground truth和predicting box设置基准的。由于Archor具有不同的尺寸，<strong>根据每一个特定的尺寸存在一个特定的bounding box regressor</strong>。</p>
<h3 id="RPN-Training"><a href="#RPN-Training" class="headerlink" title="RPN Training"></a>RPN Training</h3><p>首先<strong>标记Archor</strong>，这是一个二元分类问题。将两类archor标记为正样本：（1）每一个ground truth重合的IOU最大的archor标为正样本（2）和任意ground truth的IOU大于0.7的archor标为正样本，因此每个ground truth可能被分配给好几个archor box。此外，将和所有ground truth的IOU都小于0.3的标记为负样本，注意<strong>存在非正且非负的样本</strong>。下面给出Loss Function：</p>
<p><img src="/images/R-CNN/3.png" alt="img"></p>
<p>i是mini batch中 archor的索引。pi表示是Object的概率。第二部分是bounding box regression，只有正样本才有这一项。ti代表四个locational parameters，让predicting box从archor的位置回归到ground truth的位置。每一个特定尺寸的archor存在一个特定的bounding box regressor。和其他R-CNN不同的是，这里的直接输出值实际上就是bounding box在image上的坐标。和Fast R-CNN一样，先sample image再sample archor，batch中正负archor数量相同。</p>
<h2 id="Share-features-with-Fast-R-CNN"><a href="#Share-features-with-Fast-R-CNN" class="headerlink" title="Share features with Fast R-CNN"></a>Share features with Fast R-CNN</h2><ul>
<li>Alternatiining Training</li>
</ul>
<p>为了将两个网络作为整理训练，文中使用一种厉害的<strong>4-Step Alternating Training</strong>：不管是RPN还是Fast R-CNN网络，其网络结构一部分来自于pre-trained model的卷积层（下文简称model），另一部分则是他们各自特有的结构（有卷积和FC，下文简称unique）。</p>
<ol>
<li><p>用pre-trained model初始化RPN网络，然后训练RPN，在训练后，model以及RPN的unique会被更新。</p>
</li>
<li><p>用pre-trained model初始化Fast-rcnn网络，注意这个model的初始化并不是使用1中更新的model。然后使用训练过的RPN来计算proposal，再将proposal给予Fast-rcnn网络。接着训练Fast-rcnn。训练完以后，model以及Fast-rcnn的unique都会被更新。<br>说明：第一和第二步，用同样的model初始化RPN网络和Fast-rcnn网络，然后各自独立地进行训练，所以训练后，各自对model的更新一定是不一样的，因此就意味着model是不共享的。</p>
</li>
<li><p>使用第二步训练完成的model来初始化RPN网络，第二次训练RPN网络。但是这次要把model锁定，训练过程中，model始终保持不变，而RPN的unique会被改变。<br>说明：因为这一次的训练过程中，model始终保持和上一步Fast-rcnn中model一致，所以就称之为着共享。</p>
</li>
<li><p>仍然保持第三步的model不变，初始化Fast-rcnn，第二次训练Fast-rcnn网络。其实就是对其unique进行finetune，训练完毕，得到一个文中所说的unified network。</p>
</li>
</ol>
<ul>
<li>End to end training</li>
</ul>
<p>这种方式就是直接的端到端的训练方式，由RPN生成region proposal和Loss_1，然后将RPN得到的proposal输入到Fast R-CNN中得到detection Loss_2，加和两个loss做Multi-task training。</p>
<h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><ul>
<li>训练的时候我们不采用任何超过边界的archor，但是测试的时候我们使用clip的方式，即填充。</li>
<li>RPN得到的box实际上是image级别的，但是我们可以根据数学关系得到feature map级别的proposal，再通过ROI pooling得到<strong>固定尺寸</strong>的proposal输入到Fast R-CNN中</li>
<li>在test time通过RPN会生成很多region proposal，先通过NMS删除重合度高的proposal，再根据object score选择score值最高的N个（这里最好的值为300）proposal。可以发现数量大大减少，同时得到了mAP的提升。</li>
</ul>
<h2 id="Referece"><a href="#Referece" class="headerlink" title="Referece"></a>Referece</h2><ol>
<li><a href="http://de.arxiv.org/pdf/1506.01497" target="_blank" rel="noopener">paper</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24916624" target="_blank" rel="noopener">解析</a></li>
<li><a href="https://blog.csdn.net/zziahgf/article/details/79311275" target="_blank" rel="noopener">CSDN</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24780433" target="_blank" rel="noopener">如何将ROI映射回原图</a></li>
</ol>

      
    </div>

    

    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------That's the end of this passage<i class="fa fa-paw"></i>-------------</div>
    
</div>
      
    </div>

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Object-Detection/" rel="tag"><i class="fa fa-tag"></i> Object Detection</a>
          
            <a href="/tags/Paper-Reading/" rel="tag"><i class="fa fa-tag"></i> Paper Reading</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/YOLO.html" rel="next" title="YOLO (You Only Look Once)">
                <i class="fa fa-chevron-left"></i> YOLO (You Only Look Once)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/sale.html" rel="prev" title="CK的二手交易市场">
                CK的二手交易市场 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Kai Chen">
            
              <p class="site-author-name" itemprop="name">Kai Chen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/KaiChen1998" title="GitHub &rarr; https://github.com/KaiChen1998"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.facebook.com/profile.php?id=100028339790836" title="FB Page &rarr; https://www.facebook.com/profile.php?id=100028339790836" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FB Page</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.linkedin.com/in/kai-chen1998/" title="Linkedin &rarr; https://www.linkedin.com/in/kai-chen1998/" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i>Linkedin</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:kchen16@fudan.edu.cn" title="E-Mail &rarr; mailto:kchen16@fudan.edu.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#R-CNN"><span class="nav-number">1.</span> <span class="nav-text">R-CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Training-Process"><span class="nav-number">1.1.</span> <span class="nav-text">Training Process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#迁移学习"><span class="nav-number">1.1.1.</span> <span class="nav-text">迁移学习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hard-negative-mining"><span class="nav-number">1.1.2.</span> <span class="nav-text">hard negative mining</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Testing-Process"><span class="nav-number">1.2.</span> <span class="nav-text">Testing Process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">1.3.</span> <span class="nav-text">Reference</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Fast-CNN"><span class="nav-number">2.</span> <span class="nav-text">Fast CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Training"><span class="nav-number">2.1.</span> <span class="nav-text">Training</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Architecture"><span class="nav-number">2.1.1.</span> <span class="nav-text">Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROI-projection"><span class="nav-number">2.1.2.</span> <span class="nav-text">ROI projection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROI-pooling-layer"><span class="nav-number">2.1.3.</span> <span class="nav-text">ROI pooling layer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process：end-to-end-training"><span class="nav-number">2.1.4.</span> <span class="nav-text">Process：end to end training</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Testing"><span class="nav-number">2.2.</span> <span class="nav-text">Testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference-1"><span class="nav-number">2.3.</span> <span class="nav-text">Reference</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Faster-CNN"><span class="nav-number">3.</span> <span class="nav-text">Faster CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Region-Proposal-Network-（RPN）"><span class="nav-number">3.1.</span> <span class="nav-text">Region Proposal Network （RPN）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Archor"><span class="nav-number">3.1.1.</span> <span class="nav-text">Archor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RPN-Training"><span class="nav-number">3.1.2.</span> <span class="nav-text">RPN Training</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Share-features-with-Fast-R-CNN"><span class="nav-number">3.2.</span> <span class="nav-text">Share features with Fast R-CNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Details"><span class="nav-number">3.3.</span> <span class="nav-text">Details</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Referece"><span class="nav-number">3.4.</span> <span class="nav-text">Referece</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kai Chen</span>

  

  
</div>

<!--

  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.6.0</div>



-->
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">Blog words total counts: 24k</span>
</div>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


















  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  
  

  
  

  


  
  

  

  

  

  

  

  

</body>
</html>
